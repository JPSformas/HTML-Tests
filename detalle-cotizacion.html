<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Cotizaciones</title>
    <!-- Bootstrap 5 & FontAwesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=drag_indicator" />
    
    <link href="detalle-cotizacion.css" rel="stylesheet">
    <link href="complementos.css" rel="stylesheet">
    <link href="sidebar.css" rel="stylesheet">
    <link href="nuevo-header.css" rel="stylesheet">
</head>
<body>
    <!-- ==========  HEADER GLOBAL  ========== -->
    <header class="navbar navbar-dark bg-black py-3">
        <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="https://formas.shop/app">
            <img src="IMG/Logo Formas.shop 2025-02.png" alt="Logo" style="max-height:30px">
        </a>
    
        <!-- Iconos derecha -->
        <div class="d-flex align-items-center ms-auto">
            <div class="dropdown">
            <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="avatar-circle d-inline-flex align-items-center justify-content-center me-2">
                    <i class="fa-solid fa-user"></i>
                    </span>
                <span class="d-none d-md-inline userDataName">Invitado</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                <span class="dropdown-item-text userDataName-mobile">Invitado</span>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/app/order/list">Mis pedidos</a></li>
                <li><a class="dropdown-item" href="/app/order/repeat">Últimas compras</a></li>
                <li><a class="dropdown-item" href="/app/order-cotization">Mis cotizaciones</a></li>
                <li><a class="dropdown-item" href="/logout">Salir</a></li>
            </ul>
            </div>
            <a href="" class="btn text-white position-relative"><i class="fas fa-cart-shopping fa-xl"></i>
                <span class="position-absolute top-10 start-90 translate-middle  cart-count">2</span>
            </a>
        </div>
        </div>
    </header>
    <main class="container py-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <a href="#" class="back-link">
                <i class="fas fa-chevron-left"></i> Volver a mis cotizaciones
            </a>
            <div>
                <button type="button" class="btn btn-outline-secondary me-2 d-none guardarCotizacion" data-cotization="#">
                    Guardar cotización
                </button>
                <a class="btn btn-primary generarCotizacion" data-cotization="#" href="#">
                    Generar PDF
                </a>
            </div>
        </div>

        <!-- ==========  CONTENIDO PRINCIPAL  ========== -->
        <div class="card">
            <div class="card-section">
                <h1 class="h4 mb-0 fw-bold mb-4">Cotización</h1>
                <!-- Estructura con grid 2x2 en cada columna -->
                <div class="row mb-5">
                    <!-- Columna izquierda -->
                    <div class="col-md-6 pe-md-4 border-end">
                        <div class="row mb-0 mb-md-3">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <label for="cotizationName" class="form-label">Nombre de cotización</label>
                                <input type="text" id="name" name="cotizationName" class="form-control" value="Prueba JP">
                            </div>
                            <div class="col-md-6">
                                <label for="dateFrom" class="form-label">Fecha</label>
                                <input type="text" class="form-control" id="dateFrom" name="dateFrom" value="07/04/2025" readonly>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <label for="nombreApellido" class="form-label">Nombre y Apellido</label>
                                <input type="text" id="nombreApellido" name="nombreApellido" class="form-control" value="">
                            </div>
                            <div class="col-md-6">
                                <label for="razonSocial" class="form-label">Razón Social</label>
                                <input type="text" id="razonSocial" name="razonSocial" class="form-control" value="">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Columna derecha-->
                    <div class="col-md-6 ps-md-4">
                        <div class="row mb-0 mb-md-3">
                            <div class="col-md-6" id="configPrecios" name="configPrecios">
                                <label for="configPrecios" class="form-label">Configuración de precios</label>
                                <select class="form-select">
                                    <option value="conPrecio" selected>Con precio</option>
                                    <option value="sinPrecio">Sin precio</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3 mb-md-0">
                                <label for="precioExtraImpresion" class="form-label">Costo extra impresión</label>
                                <input type="text" class="form-control" id="precioExtraImpresion" name="precioExtraImpresion" value="30000">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4 mb-md-0">
                                <label for="descuentoGeneral" class="form-label">Descuento general</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="descuentoGeneral" name="descuentoGeneral" placeholder="0" inputmode="numeric">
                                    <span class="input-group-text">%</span>
                                </div>
                            </div>
                            <div class="col-md-6 d-flex align-items-end">
                                <!-- Botón para desktop -->
                                <button type="button" class="btn btn-outline-secondary w-100 d-none d-md-block" data-bs-toggle="modal" data-bs-target="#masElementosModal">
                                    <i class="fas fa-plus"></i>Más elementos
                                </button>
                                <!-- Botón para mobile -->
                                <button type="button" class="btn btn-outline-secondary w-100 d-md-none" data-bs-toggle="offcanvas" data-bs-target="#sidebarMasElementos">
                                    <i class="fas fa-plus"></i>Más elementos
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="table-title">Productos</div>
                    <div class="dropdown">
                        <button class=" btn btn-outline-secondary d-flex align-items-center dropdown-toggle" type="button" id="dropdownAgregarProductos" data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="d-inline ">Agregar producto</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAgregarProductos">
                            <li class="dropdown-item option">Producto importado</li>
                            <li>
                                <a href="" class="dropdown-item option text-decoration-none">Producto genérico</a>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div class="table-responsive mb-4">
                    <table class="table">
                        <tbody>
                            <tr id="item-1" class="item-container" data-id="#">
                                <td class="dragItem">
                                    <span class="material-symbols-outlined">drag_indicator</span>
                                </td>
                                <td class="text-center">
                                    <div class="product-image mx-auto">
                                        <img src="IMG/placeholder3.jpg" alt="Gorro Roger" class="product-img">
                                    </div>
                                </td>
                                <td class="productName">
                                    Gorro Tiger - Gris claro
                                </td>
                                <td class="productDescription">
                                    <p>Gorro de 6 paneles realizado en Cotton Flex (microfibra). Cierre velcro tipo Shiny Soft y sticker metalizado en visera. Slazeneger</p>
                                </td>
                                <td class="productQuantities">
                                    <div class="quantities-tag">x50</div> 
                                    <div class="quantities-tag">x100</div>
                                    <div class="quantities-tag">x200</div>
                                    <div class="quantities-tag">x500</div>
                                    <div class="quantities-tag">x1000</div>
                                </td>
                                <td>
                                    <a href="editItem.html" class="edit-btn" data-itemid="#"><i class="fas fa-edit"></i></a>
                                    <a href="editItem.html" class="edit-btn-mobile" data-itemid="#"><span>Editar</span></a>
                                    <button type="button" class="delete-btn-mobile"><span>Eliminar</span></button>
                                </td>
                                <td>
                                    <button type="button" class="delete-btn"><i class="far fa-trash-alt"></i></button>
                                </td>
                            </tr>
                            <tr id="item-2" class="item-container" data-id="#">
                                <td class="dragItem">
                                    <span class="material-symbols-outlined">drag_indicator</span>
                                </td>
                                <td class="text-center">
                                    <div class="product-image mx-auto">
                                        <img src="IMG/placeholder.jpg" alt="Gorro Roger" class="product-img">
                                    </div>
                                </td>
                                <td class="productName">
                                    Herschel Classic Backpack
                                </td>
                                <td class="productDescription">
                                    <p>Classic
                                        <br>
                                        Es clásica por un motivo: es minimalista y versátil, ideal para usar todos los días. Capacidad de 20 litros.
                                        <br>
                                        Cuenta con un bolsillo delantero y en su compartimento principal, con una funda interior que se adapta a una laptop de 14"
                                        <br>
                                        Tiene cierres con tiradores de cordón y correas acolchadas ajustables para los hombros.
                                        <br>
                                        Material: Poliéster 600D reciclado, está elaborado con botellas de agua usadas recuperadas. Todos los  materiales reciclados de los productos Herschel pertenecen a la marca registrada EcoSystem™ 
                                    </p>
                                </td>
                                <td class="productQuantities">
                                    <div class="quantities-tag">x50</div> 
                                    <div class="quantities-tag">x100</div>
                                    <div class="quantities-tag">x200</div>
                                    <div class="quantities-tag">x500</div>
                                    <div class="quantities-tag">x1000</div>
                                </td>
                                <td>
                                    <a href="editItem.html" class="edit-btn" data-itemid="#"><i class="fas fa-edit"></i></a>
                                    <a href="editItem.html" class="edit-btn-mobile" data-itemid="#"><span>Editar</span></a>
                                    <button type="button" class="delete-btn-mobile"><span>Eliminar</span></button>
                                </td>
                                <td><button type="button" class="delete-btn"><i class="far fa-trash-alt"></i></button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="row px-3 mb-4">
                    <label class="form-label">Observaciones de la cotización</label>
                    <textarea class="form-control" rows="3">Los valores mencionados no incluyen IVA. Validez del presupuesto: 72 hs. Condición de pago: Transferencia</textarea>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Más Elementos Desktop-->
    <div class="modal fade" id="masElementosModal" tabindex="-1" aria-labelledby="masElementosModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="masElementosModalLabel">Elementos adicionales</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Tabla -->
                    <div class="table-responsive mb-2">
                        <table class="table table-modal">
                            <thead><tr><th style="width: 180px; min-width: 110px">Cantidad</th><th style="width: 180px; min-width: 110px">Costo extra</th><th style="width: 180px; min-width: 110px">Margen</th><th style="width: 180px; min-width: 110px">Financiación</th><th></th></tr></thead>
                            <tbody>
                            <tr>
                                <td class="colCotizacionCantidad"><input type="number" class="form-control form-control-sm" value="50"></td>
                                <td class="colCotizacionCostoExtra"><input type="text" class="form-control form-control-sm" ></td>
                                <td class="colCotizacionMargen">
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="colCotizacionMargen" name="colCotizacionMargen" placeholder="0" inputmode="numeric">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </td>
                                <td class="colCotizacionFinanciacion">
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="colCotizacionFinanciacion" name="colCotizacionFinanciacion" placeholder="0" inputmode="numeric">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </td>
                                <td class="text-center align-middle"><button type="button" class="delete-btn"><i class="far fa-trash-alt"></i></button></td>
                            </tr>
                            <tr>
                                <td class="colCotizacionCantidad"><input type="number" class="form-control form-control-sm" value="100"></td>
                                <td class="colCotizacionCostoExtra"><input type="text" class="form-control form-control-sm" ></td>
                                <td class="colCotizacionMargen">
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="colCotizacionMargen" name="colCotizacionMargen" placeholder="0" inputmode="numeric">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </td>
                                <td class="colCotizacionFinanciacion">
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="colCotizacionFinanciacion" name="colCotizacionFinanciacion" placeholder="0" inputmode="numeric">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </td>
                                <td class="text-center align-middle"><button type="button" class="delete-btn"><i class="far fa-trash-alt"></i></button></td>
                            </tr>
                            <tr>
                                <td class="colCotizacionCantidad"><input type="number" class="form-control form-control-sm" value="200"></td>
                                <td class="colCotizacionCostoExtra"><input type="text" class="form-control form-control-sm" ></td>
                                <td class="colCotizacionMargen">
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="colCotizacionMargen" name="colCotizacionMargen" placeholder="0" inputmode="numeric">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </td>
                                <td class="colCotizacionFinanciacion">
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="colCotizacionFinanciacion" name="colCotizacionFinanciacion" placeholder="0" inputmode="numeric">
                                        <span class="input-group-text">%</span>
                                    </div>
                                </td>
                                <td class="text-center align-middle"><button type="button" class="delete-btn"><i class="far fa-trash-alt"></i></button></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-outline-secondary mb-2" style="font-size: 14px;" id="agregarCantidadDesktop"><i class="fas fa-plus"></i>Agregar cantidad</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary">Guardar cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar para Más Elementos (Mobile) -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="sidebarMasElementos" aria-labelledby="sidebarMasElementosLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="sidebarMasElementosLabel">Más elementos</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="d-grid gap-2">
                <button class="btn btn-outline-primary" type="button" id="btnAgregarCantidades">
                    Agregar cantidades
                </button>
                <div class="saved-quantities mb-3">
                    <div class="quantities-card">
                        <div class="fieldLabel" >Cantidad: <span class="fieldValue">50</span></div>
                        <div class="fieldLabel" >Costo extra: <span class="fieldValue"></span></div>
                        <div class="fieldLabel" >Margen: <span class="fieldValue"></span></div>
                        <div class="fieldLabel" >Financiación: <span class="fieldValue"></span></div>
                        <div class="action-buttons">
                        <button href="" class="edit-btn-mobile" data-itemid="#"><span>Editar</span></button>
                        <button type="button" class="delete-btn-mobile"><span>Eliminar</span></button>
                        </div>
                    </div>
                    <div class="quantities-card">
                        <div class="fieldLabel" >Cantidad: <span class="fieldValue">100</span></div>
                        <div class="fieldLabel" >Costo extra: <span class="fieldValue"></span></div>
                        <div class="fieldLabel" >Margen: <span class="fieldValue"></span></div>
                        <div class="fieldLabel" >Financiación: <span class="fieldValue"></span></div>
                        <div class="action-buttons">
                        <button href="" class="edit-btn-mobile" data-itemid="#"><span>Editar</span></button>
                        <button type="button" class="delete-btn-mobile"><span>Eliminar</span></button>
                        </div>
                    </div>
                    <div class="quantities-card">
                        <div class="fieldLabel" >Cantidad: <span class="fieldValue">200</span></div>
                        <div class="fieldLabel" >Costo extra: <span class="fieldValue"></span></div>
                        <div class="fieldLabel" >Margen: <span class="fieldValue"></span></div>
                        <div class="fieldLabel" >Financiación: <span class="fieldValue"></span></div>
                        <div class="action-buttons">
                        <button href="" class="edit-btn-mobile" data-itemid="#"><span>Editar</span></button>
                        <button type="button" class="delete-btn-mobile"><span>Eliminar</span></button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar anidado para Agregar Cantidades -->
            <div class="nested-sidebar" id="nestedSidebar">
                <div class="nested-sidebar-header">
                    <button type="button" class="btn-back" id="btnBackNestedSidebar">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h5>Agregar cantidades</h5>
                </div>
                <div class="nested-sidebar-body">
                    <!-- Campos adicionales -->
                    <label class="form-label d-block w-100">
                        <span>Cantidad</span> 
                        <input type="number" class="form-control mt-2" name="colCotizacionCantidad" min="1" >
                    </label>
                    <label class="form-label d-block w-100">
                        <span>Costo extra</span>
                        <input type="text" class="form-control mt-2" name="colCotizacionCostoExtra">
                    </label>
                    <label class="form-label d-block w-100">
                        <span>Margen</span>
                        <div class="input-group mt-2">
                            <input type="number" class="form-control" name="colCotizacionMargen" placeholder="0" inputmode="numeric">
                            <span class="input-group-text">%</span>
                        </div>
                    </label>
                    <label class="form-label d-block w-100">
                        <span>Financiación</span>
                        <div class="input-group mt-2">
                            <input type="number" class="form-control" name="colCotizacionFinanciacion" placeholder="0" inputmode="numeric">
                            <span class="input-group-text">%</span>
                        </div>
                    </label>
                </div>
                <div class="nested-sidebar-footer">
                    <button type="button" class="btn btn-primary w-100">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Producto PIC Modal -->
    <div class="modal fade" id="productoPicModal" tabindex="-1" aria-labelledby="productoPicModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" >
            <div class="modal-content">
                <form id="picProductForm">
                    <div class="modal-header">
                        <h5 class="modal-title" id="productoPicModalLabel">Nuevo producto PIC</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                    </div>

                    <div class="modal-body">
                        <div class="row g-3">
                            <!-- ===== Datos generales ===== -->
                            <div class="col-md-6">
                                <label class="form-label" for="picSeller">Vendedor*</label>
                                <input type="text" class="form-control" id="picSeller" name="seller" required>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" for="picClient">Cliente*</label>
                                <input type="text" class="form-control" id="picClient" name="client" required>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label" for="picNumber">N° de PIC*</label>
                                <input type="text" class="form-control" id="picNumber" name="picNumber" required>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label" for="picDate">Fecha*</label>
                                <input type="date" class="form-control" id="picDate" name="picDate" required>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label" for="picDueDate">Fecha de vencimiento*</label>
                                <input type="date" class="form-control" id="picDueDate" name="dueDate" required>
                            </div>

                            <!-- ===== Información básica del producto ===== -->
                            <div class="col-md-6">
                                <label class="form-label" for="picProductName">Producto*</label>
                                <input type="text" class="form-control" id="picProductName" name="productName" required>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" for="picQuantity">Cantidad*</label>
                                <input type="number" class="form-control" id="picQuantity" name="quantity" min="1" required>
                            </div>

                            <div class="col-12">
                                <label class="form-label" for="picDescription">Descripción</label>
                                <textarea class="form-control" id="picDescription" name="description" rows="3" spellcheck="true"></textarea>
                            </div>

                            <!-- ===== Precios ===== -->
                            <div class="col-md-6">
                                <label class="form-label" for="picPriceMin">Rango de precio (mín-máx)</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="picPriceMin" name="priceMin" placeholder="Mín">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="picPriceMax" name="priceMax" placeholder="Máx">
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" for="picPrice">Precio unitario</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="picPrice" name="price">
                                </div>
                            </div>

                            <!-- ===== Branding ===== -->
                            <div class="col-md-6">
                                <label class="form-label" for="picLogoSystem">Sistema aplicación logo</label>
                                <select class="form-select" id="picLogoSystem" name="logoSystem">
                                    <option selected disabled value="">Seleccionar…</option>
                                    <option value="bordado">Bordado</option>
                                    <option value="serigrafia">Serigrafía</option>
                                    <option value="transfer">Transfer</option>
                                    <option value="tampografia">Tampografía</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" for="picLogoColors">Colores de logo</label>
                                <input type="number" class="form-control" id="picLogoColors" name="logoColors" min="1">
                            </div>

                            <!-- ===== Tiempos & Extras ===== -->
                            <div class="col-md-6">
                                <label class="form-label" for="picDeliveryTime">Tiempo de entrega (días)</label>
                                <input type="number" class="form-control" id="picDeliveryTime" name="deliveryTime" min="1">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" for="picExtraCost">Costo extra impresión</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="picExtraCost" name="extraCost">
                                </div>
                            </div>

                            <!-- ===== Observaciones ===== -->
                            <div class="col-12">
                                <label class="form-label" for="picObservations">Observaciones</label>
                                <textarea class="form-control" id="picObservations" name="observations" rows="2"></textarea>
                            </div>

                            <!-- ===== Imagen ===== -->
                            <div class="col-12">
                                <label class="form-label" for="picImage">Imagen</label>
                                <input class="form-control" type="file" id="picImage" name="image" accept="image/*">
                                <div class="mt-2" id="picImagePreview" style="display:none;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Preview de imagen rápida
            document.getElementById('picImage').addEventListener('change', function (e) {
                const preview = document.getElementById('picImagePreview');
                const file = e.target.files[0];
                if (!file) { preview.style.display = 'none'; preview.innerHTML = ''; return; }
                const url = URL.createObjectURL(file);
                preview.innerHTML = '<img src="' + url + '" class="img-fluid rounded" style="max-height:140px">';
                preview.style.display = 'block';
            });
        

            // Configuración del sidebar anidado
            const btnAgregarCantidades = document.getElementById('btnAgregarCantidades');
            const nestedSidebar = document.getElementById('nestedSidebar');
            const btnBackNestedSidebar = document.getElementById('btnBackNestedSidebar');
            const mainSidebar = document.getElementById('sidebarMasElementos');
          
                   
            if (btnAgregarCantidades && nestedSidebar && btnBackNestedSidebar) {
                // Mostrar el sidebar anidado
                btnAgregarCantidades.addEventListener('click', function() {
                    nestedSidebar.classList.add('show');
                });
                
                // Ocultar el sidebar anidado
                btnBackNestedSidebar.addEventListener('click', function() {
                    nestedSidebar.classList.remove('show');
                });
            }

            if (mainSidebar && nestedSidebar) {
                mainSidebar.addEventListener('hidden.bs.offcanvas', () => {
                    nestedSidebar.classList.remove('show');
                });
            }

            initializeDragAndDrop();

        });

        function initializeDragAndDrop() {
            const tableBody = document.querySelector('table tbody');
            
            if (!tableBody) {
                console.warn('Table body not found');
                return;
            }

            const sortable = Sortable.create(tableBody, {
                animation: 200,
                handle: '.dragItem',
                ghostClass: 'sortable-ghost',
                chosenClass: 'sortable-chosen',
                dragClass: 'sortable-drag',
                
                onStart: function(evt) {
                    console.log('Drag started');
                    document.body.style.cursor = 'grabbing';
                },
                
                onEnd: function(evt) {
                    console.log('Item moved from index', evt.oldIndex, 'to', evt.newIndex);
                    document.body.style.cursor = '';
                    updateItemIds();
                    saveNewOrder();
                }
            });

            addDragHandleFeedback();
        }

        function addDragHandleFeedback() {
            const dragHandles = document.querySelectorAll('.dragItem span');
            
            dragHandles.forEach(handle => {
                handle.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.1)';
                });
                
                handle.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                });
            });
        }

        function updateItemIds() {
            const rows = document.querySelectorAll('.item-container');
            
            rows.forEach((row, index) => {
                row.id = `item-${index + 1}`;
            });
        }

        function saveNewOrder() {
            const rows = document.querySelectorAll('.item-container');
            const order = [];
            
            rows.forEach((row, index) => {
                order.push({
                    id: row.getAttribute('data-id'),
                    position: index + 1,
                    productName: row.querySelector('.productName').textContent.trim()
                });
            });
            
            localStorage.setItem('itemOrder', JSON.stringify(order));
            console.log('New order saved:', order);
        }


        const ocultarPrecio = document.getElementById('ocultarPrecio');
        const mostrarStock  = document.getElementById('mostrarStock');

        const syncSwitches = () => {
            if (ocultarPrecio.checked) {          // “Ocultar precio” ON  ➜  enable the other switch
            mostrarStock.disabled = false;
            } else {                              // “Ocultar precio” OFF ➜  force-off & disable “Mostrar stock”
            mostrarStock.checked  = false;
            mostrarStock.disabled = true;
            }
        };

        ocultarPrecio.addEventListener('change', syncSwitches);
        syncSwitches();                         // run once on page load


    </script>
</body>
</html>
